<!DOCTYPE html>
<html>

<head>
    <title>Arvandor</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html,
    body {
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
</style>

<body>

    <script>


        class Arvandor extends Phaser.Scene {

            constructor() {
                super('Arvandor');
                this.weapon = 'sword';
                this.currentIndex = 0;
                this.playerText = '';
                this.rocabroteText = 'Buenas, viajero. ¿Qué te trae por aquí?';
                this.options = ['¿Quién eres?', '¿Dónde estoy?', '¿Qué haces aquí?'];
                this.inAction = false;
                this.action = false;
                this.lives = 3;
                this.hearts = [];
                this.isAlive = true;
                this.isMoving = false;
                this.isRunning = false;
                this.glitch = 0;
                this.glitched = false;
            }
            preload() {
                this.load.image('exclamation', 'images/exclamation.png');
                this.load.spritesheet('idle', 'images/idle.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('idle_mini_sword', 'images/idle_mini_sword.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('rocabrote', 'images/rocabrote.png', { frameWidth: 32, frameHeight: 50 });
                this.load.image('background', 'images/background.jpg');
                this.load.image('ground', 'images/ground.png');
                this.load.image('rocabroteface', 'images/rocabroteface.png');
                this.load.image('playerface', 'images/playerface.png');
                this.load.spritesheet('idle_spear', 'images/idle_spear.png', { frameWidth: 50, frameHeight: 32 });
                this.load.spritesheet('idle_mini_spear', 'images/idle_mini_spear.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('idle_bow', 'images/idle_bow.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('idle_shield', 'images/idle_shield.png', { frameWidth: 32, frameHeight: 32 });
                this.load.image('heart', 'images/heart.png');
                this.load.spritesheet('running', 'images/running.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('spear_running', 'images/spear_running.png', { frameWidth: 50, frameHeight: 32 });
                this.load.spritesheet('bow_running', 'images/bow_running.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('shield_running', 'images/shield_running.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('idle_mini_shield', 'images/idle_mini_shield.png', { frameWidth: 32, frameHeight: 32 });

            }

            createAnimations() {
                this.anims.create({
                    key: 'rocabrote_anim',
                    frames: this.anims.generateFrameNumbers('rocabrote', { start: 0, end: -1 }),
                    frameRate: 3,
                    repeat: -1
                });
                this.anims.create({
                    key: 'idle_anim',
                    frames: this.anims.generateFrameNumbers('idle', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'spear_anim',
                    frames: this.anims.generateFrameNumbers('idle_spear', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'idle_mini_spear_anim',
                    frames: this.anims.generateFrameNumbers('idle_mini_spear', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'bow_anim',
                    frames: this.anims.generateFrameNumbers('idle_bow', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'shield_anim',
                    frames: this.anims.generateFrameNumbers('idle_shield', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'running_anim',
                    frames: this.anims.generateFrameNumbers('running', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'spear_running_anim',
                    frames: this.anims.generateFrameNumbers('spear_running', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'bow_running_anim',
                    frames: this.anims.generateFrameNumbers('bow_running', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'shield_running_anim',
                    frames: this.anims.generateFrameNumbers('shield_running', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'idle_mini_sword_anim',
                    frames: this.anims.generateFrameNumbers('idle_mini_sword', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                this.anims.create({
                    key: 'idle_mini_shield_anim',
                    frames: this.anims.generateFrameNumbers('idle_mini_shield', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });

                
            }

            createScenario() {
                this.add.image(0, 0, 'background').setOrigin(0, 0).setDisplaySize(window.innerWidth, window.innerHeight);

                this.platforms = this.physics.add.staticGroup();
                const groundWidth = this.textures.get('ground').getSourceImage().width;


                for (let i = 0; i < 5; i++) {
                    this.platforms.create(i * 425, window.innerHeight - 32, 'ground').setScale(0.5).refreshBody();
                }
            }

            createAssets() {
                const exclamation = this.add.sprite(0, 0, 'exclamation').setVisible(false);
                this.exclamation = exclamation;

                const main_character = this.physics.add.sprite(50, window.innerHeight - 10 - this.platforms.getChildren()[0].displayHeight, 'idle');
                const rocabrote = this.physics.add.sprite(window.innerWidth - 500, window.innerHeight - this.platforms.getChildren()[0].displayHeight - 25, 'rocabrote');

                const scaleFactor = window.innerHeight * 0.15 / main_character.height;
                const scaleFactorRocabrote = window.innerHeight * 0.2 / rocabrote.height;
                const exclamationScaleFactor = window.innerHeight / exclamation.height;

                main_character.setScale(scaleFactor);
                rocabrote.setScale(scaleFactorRocabrote);
                exclamation.setScale(exclamationScaleFactor / 17);

                main_character.setCollideWorldBounds(true);
                rocabrote.setCollideWorldBounds(true);

                rocabrote.play('rocabrote_anim');
                main_character.play('idle_anim');
                this.main_character = main_character;
                this.rocabrote = rocabrote;

                main_character.setDepth(1);
            }

            createHitBoxes() {
                if (!this.inAction) {
                    this.physics.add.overlap(this.main_character, this.rocabrote, this.showExclamation, null, this);
                } else {
                    this.exclamation.setVisible(false);
                }
                this.physics.add.collider(this.main_character, this.platforms);
                this.physics.add.collider(this.rocabrote, this.platforms);
            }

            showExclamation() {
                this.exclamation.setPosition(this.rocabrote.x, this.rocabrote.y - this.rocabrote.height * 1.7);
                this.exclamation.setVisible(true);
                this.action = true;
            }

            hideExclamation() {
                if (Phaser.Math.Distance.Between(this.main_character.x, this.main_character.y, this.rocabrote.x, this.rocabrote.y) > 50) {
                    this.exclamation.setVisible(false);
                    this.action = false;
                }
            }

            changeWeapon(animationKey) {
                this.main_character.play(animationKey);
            }


            create() {
                this.createScenario();
                this.createAnimations();
                this.createAssets();
                this.createHitBoxes();
                this.cursors = this.input.keyboard.createCursorKeys();

                const heartSpacing = 50;
                for (let i = 0; i < this.lives; i++) {
                    const heart = this.add.image(30 + i * heartSpacing, 30, 'heart').setScale(0.05).setOrigin(0.5, 0.5);
                    this.hearts.push(heart);
                }

                this.tweens.add({
                    targets: this.hearts[this.lives - 1],
                    scale: { from: 0.05, to: 0.06 },
                    duration: 150 * this.lives,
                    yoyo: true,
                    repeat: -1
                });
            }

            //función obsoleta por ahora
            reloadHearts() {
                this.hearts.forEach(heart => heart.destroy());
                this.hearts = [];
                const heartSpacing = 50;
                for (let i = 0; i < this.lives; i++) {
                    const heart = this.add.image(30 + i * heartSpacing, 30, 'heart').setScale(0.05).setOrigin(0.5, 0.5);
                    this.hearts.push(heart);
                }
            }

            animateHearts() {
                let heartSpeed = 150 * this.lives;

                this.tweens.add({
                    targets: this.hearts[this.lives - 1],
                    scale: { from: 0.05, to: 0.06 },
                    duration: heartSpeed,
                    yoyo: true,
                    repeat: -1
                });
            }

            loseLife(lifes) {
                if (this.lives > 0) {

                    for (let i = 0; i < lifes; i++) {
                        const lostHeart = this.hearts.pop();
                        lostHeart ? lostHeart.destroy() : null;
                    }

                    this.lives -= lifes;

                    if (this.lives <= 0) {
                        this.gameOver();
                        return;
                    }


                    this.animateHearts();
                }
            }

            gameOver() {
                this.add.text(window.innerWidth / 2, window.innerHeight / 2, 'Test', {
                    font: '64px Arial',
                    fill: '#ff0000'
                }).setOrigin(0.5);
                this.scene.pause();
            }


            enableDragAndDrop() {

                if (this.optionTexts) {
                    this.optionTexts.forEach(optionText => optionText.destroy());
                    
                    
                }

                this.optionTexts = [];

                this.options.forEach((opt, idx) => {


                    const optionText = this.add.text(0, 100 + (idx * 60), opt,
                        { font: '16px', fontFamily: '"Press Start 2P"', fill: '#000000', backgroundColor: '#ffffff', padding: { x: 10, y: 5 } }
                    ).setInteractive();

                    this.tweens.add({
                        targets: optionText,
                        x: 100,
                        duration: 500,
                        ease: 'Power2'
                    });


                    this.input.setDraggable(optionText);
                    this.optionTexts.push(optionText);

                    optionText.on('dragstart', (pointer, dragX, dragY) => {
                        optionText.setAlpha(0.5);
                    });

                    optionText.on('drag', (pointer, dragX, dragY) => {
                        optionText.x = dragX;
                        optionText.y = dragY;
                    });

                    optionText.on('dragend', (pointer, dragX, dragY, dropped) => {
                        if (!dropped) {
                            optionText.setAlpha(1);
                            optionText.x = 100;
                            optionText.y = 100 + (idx * 60);
                        }
                    });
                });

                const dropZone = this.add.zone(
                    window.innerWidth / 2,
                    window.innerHeight * 3 / 4,
                    window.innerWidth - 40,
                    100
                ).setRectangleDropZone(window.innerWidth - 40, 100);

                this.input.on('drop', (pointer, gameObject) => {
                    const selectedOption = gameObject.text;
                    gameObject.destroy();

                    switch (selectedOption) {
                        case '¿Quién eres?':
                            this.rocabroteText = 'Soy Rocabrote, el guardián de este lugar.';
                            this.options = ['¿Cuál es tu misión?', '¿Cómo llegaste aquí?'];
                            break;
                        case '¿Dónde estoy?':
                            this.rocabroteText = 'Estás en Arvandor, un lugar místico y antiguo.';
                            this.options = ['¿Qué puedo hacer aquí?', '¿Es peligroso?'];
                            break;
                        case '¿Qué haces aquí?':
                            this.rocabroteText = 'Estoy aquí para guiar a los viajeros como tú.';
                            this.options = ['¿Cómo me puedes ayudar?', '¿Qué debo hacer ahora?'];
                            break;
                        case '¿Cuál es tu misión?':
                            this.rocabroteText = 'Mi misión es proteger este lugar de los intrusos.';
                            this.options = ['¿Cómo llegaste aquí?', '¿Qué debo hacer ahora?'];
                            break;
                        case '¿Cómo llegaste aquí?':
                            this.rocabroteText = 'Llegué aquí hace muchos años, guiado por una visión.';
                            this.options = ['¿Qué visión?', '¿Qué debo hacer ahora?'];
                            break;
                        case '¿Qué puedo hacer aquí?':
                            this.rocabroteText = 'Puedes explorar, aprender y ayudar a proteger este lugar.';
                            this.options = ['¿Cómo puedo ayudar?', '¿Es peligroso?'];
                            break;
                        case '¿Es peligroso?':
                            this.rocabroteText = 'Puede serlo, pero con cuidado y sabiduría, estarás a salvo.';
                            this.options = ['¿Cómo puedo estar seguro?', '¿Qué debo hacer ahora?', 'Pedazo de cursilada de texto'];
                            break;

                        case 'Pedazo de cursilada de texto':
                            this.rocabroteText = 'No sé qué decirte, viajero. ¿Necesitas algo más?';
                            this.options = ['¿Eres consciente de que estamos en un juego?', 'Cuéntame más sobre Arvandor', 'Salir'];
                            break;

                        case '¿Eres consciente de que estamos en un juego?':
                            this.glitch++;

                            if (this.glitch > 3) {
                                this.glitched = true;
                                this.rocabrote.setScale(20);
                                this.rocabroteTextBox.setStyle({
                                    backgroundColor: '#000000',
                                    fill: '#ffffff'
                                });

                                this.cameras.main.shake(200, 0.02, true).on('camerashakecomplete', () => {
                                    if (this.inAction) {
                                        this.cameras.main.flash(500, 255, 0, 0, true).on('cameraflashcomplete', () => {
                                            this.cameras.main.shake(200, 0.02, true);
                                        });
                                    }
                                });



                                this.rocabroteText = 'OAWIJDOIAHDOPIABUABIUBWAIUGFIUOABIUCBIUAWDADUASIDAIPWDGA';
                                this.options = ['???', '???', '???'];
                            } else {
                                this.rocabroteText = 'No sé de qué hablas, viajero. ¿Necesitas algo más?';
                                this.options = ['¿Eres consciente de que estamos en un juego?', 'Cuéntame más sobre Arvandor', 'Salir'];
                            }
                            break;

                        case '???':
                            this.rocabroteText = '?¿!")!)=i?js=)=)jhs=)h!=u=u@#|#DAgdygdiuagidw9dUDAHDUHADDA';
                            this.options = ['Ni siquiera tengo esto programado'];

                            break;

                        case 'Ni siquiera tengo esto programado':
                            this.rocabroteText = '¿QUÉ ME HAS HECHO?';
                            this.options = ['No lo sé', 'Salir'];
                            break;

                        case 'No lo sé':
                            this.rocabroteText = '¿QUÉ ME HAS...?';
                            this.options = ['...', 'Salir'];
                            break;

                        case '...':
                            this.rocabroteText = '¿QUÉ ME HAS...?';
                            this.options = ['...', 'Salir'];
                            break;
                        case '¿Cómo me puedes ayudar?':
                            this.rocabroteText = 'Puedo darte consejos y guiarte en tu viaje.';
                            this.options = ['¿Qué consejos tienes?', '¿Qué debo hacer ahora?'];
                            break;
                        case '¿Qué debo hacer ahora?':
                            this.rocabroteText = 'Sigue tu corazón y busca la verdad en todo lo que encuentres.';
                            this.options = ['Gracias', 'Adiós'];
                            break;
                        case '¿Qué visión?':
                            this.rocabroteText = 'Una visión de paz y protección para este lugar sagrado.';
                            this.options = ['¿Cómo puedo ayudar?', '¿Qué debo hacer ahora?'];
                            break;
                        case '¿Cómo puedo ayudar?':
                            this.rocabroteText = 'Ayuda a mantener la paz y protege a los inocentes.';
                            this.options = ['¿Qué debo hacer ahora?', 'Gracias'];
                            break;
                        case '¿Cómo puedo estar seguro?':
                            this.rocabroteText = 'Aún viendo tu potencial, con ese arma no llegarás lejos.';
                            this.options = ['Mi espada es más que suficiente', '¿Tienes algo para mí?'];
                            break;
                        case '¿Qué consejos tienes?':
                            this.rocabroteText = 'Pareces fuerte, pero no llegarás muy lejos sin una buena arma.';
                            this.options = ['¿Tienes algo para mí?', 'Mi espada es más que suficiente'];
                            break;
                        case 'Mi espada es más que suficiente':
                            this.rocabroteText = 'No subestimes a tus enemigos, viajero. La sabiduría es tu mejor arma.';
                            this.options = ['¿Qué debo hacer ahora?', 'Prefiero otro arma', 'Gracias'];
                            break;
                        case '¿Tienes algo para mí?':
                            this.rocabroteText = 'A juzgar por tu mirada, necesitas algo más que una espada. Adelante, te doy a elegir.';
                            this.options = ['Lanza', 'Escudo', 'Arco'];
                            break;
                        case 'Lanza':
                            this.rocabroteText = 'Con esta lanza podrás atacar a tus enemigos con mayor alcance. Buena elección.';
                            this.options = ['Gracias', 'Adiós'];
                            this.changeWeapon('spear_anim');
                            this.weapon = 'spear';
                            break;
                        case 'Escudo':
                            this.rocabroteText = 'Con este escudo podrás protegerte de los ataques enemigos. Te irá bien en tu viaje.';
                            this.options = ['Gracias', 'Adiós'];
                            this.changeWeapon('shield_anim');
                            this.weapon = 'shield';
                            break;
                        case 'Arco':
                            this.rocabroteText = 'Con este arco podrás atacar a tus enemigos desde la distancia. Buena elección.';
                            this.options = ['Gracias', 'Adiós'];
                            this.changeWeapon('bow_anim');
                            this.weapon = 'bow';
                            break;
                        case 'Gracias':
                            this.rocabroteText = 'De nada, viajero. Que tengas un buen viaje.';
                            this.options = ['Adiós'];
                            break;
                        case 'Adiós':
                            this.rocabroteText = 'Adiós, viajero. Que encuentres lo que buscas.';
                            this.options = ['Salir'];
                            break;
                        case 'Salir':

                            if (this.glitched) {
                                this.rocabrote.setScale(1);
                                this.rocabroteText = 'Ahora soy minúsculo, estarás contento, ¿no?';
                                this.options = ['¿Me puedes dar algún arma?', 'Salir'];

                            }

                            else {
                                this.rocabroteText = '¿Necesitas algo más?';
                                this.options = ['Prefiero otro arma', 'Cuéntame más sobre Arvandor', 'Salir'];
                            }

                            this.endConversation();
                            return;
                            break;

                        case '¿Me puedes dar algún arma?':
                            this.rocabroteText = '¡Claro! ¿Te refieres a las armas que has encogido por romper el juego? ¡Elige!';
                            this.options = ['Mini lanza', 'Mini arco', 'Mini escudo', 'Mejor me quedo con mi espada'];
                            break;

                        case 'Mejor me quedo con mi espada':
                            this.rocabroteText = '¡Ni de coña! ¡Ahora eliges!';
                            this.options = ['Mini lanza', 'Mini arco', 'Mini escudo', '¿Puedes encoger mi espada?'];
                            break;

                        case 'Mini lanza':
                            this.rocabroteText = '¡Aquí tienes tu mini lanza! ¡Que te sea útil!';
                            this.options = ['Gracias', 'Adiós'];
                            this.changeWeapon('idle_mini_spear_anim');
                            this.weapon = 'mini_spear';
                            break;

                        case 'Mini arco':
                            this.rocabroteText = '¡Aquí tienes tu mini arco! ¡Que te sea útil!';
                            this.options = ['Gracias', 'Adiós'];
                            this.changeWeapon('bow_anim');
                            this.weapon = 'bow';
                            break;

                        case 'Mini escudo':
                            this.rocabroteText = '¡Aquí tienes tu mini escudo! ¡Que te sea útil!';
                            this.options = ['Esto no es Fortnite', '¿Gracias?'];
                            this.changeWeapon('idle_mini_shield_anim');
                            this.weapon = 'mini_shield';
                            break;

                        case '¿Puedes encoger mi espada?':
                            this.rocabroteText = '¡Pues claro! De lo contrario, el creador del juego no habría puesto esta opción.';
                            this.options = ['Gracias', 'Adiós'];
                            this.changeWeapon('idle_mini_sword_anim');
                            this.weapon = 'mini_sword';
                            break;

                        case 'Esto no es Fortnite':
                            this.rocabroteText = '¡Pues vaya! ¡Aquí tienes tu mini escudo! ¡Que te sea útil!';
                            this.options = ['Gracias', 'Adiós'];
                            break;

                        case '¿Gracias?':
                            this.rocabroteText = '¡De nada! ¡Que te sea útil!';
                            this.options = ['Salir'];
                            break;

                        case 'Cuéntame más sobre Arvandor':
                            this.rocabroteText = 'Arvandor es un lugar mágico y antiguo, lleno de secretos y peligros.';
                            this.options = ['¿Es peligroso?', '¿Qué puedo hacer aquí?', 'Salir'];
                            break;

                        case 'Prefiero otro arma':
                            this.rocabroteText = 'Sin problema. ¿Qué prefieres?';
                            this.options = ['Lanza', 'Escudo', 'Arco', 'Con mi espada será suficiente'];
                            break;

                        case 'Con mi espada será suficiente':
                            this.rocabroteText = 'Como quieras, viajero. Que tengas un buen viaje.';
                            this.options = ['Salir'];
                            this.changeWeapon('idle');
                            this.weapon = 'sword';
                            break;
                        default:
                            this.rocabroteText = 'No entiendo tu pregunta.';
                            this.options = ['Volver a preguntar', 'Salir'];
                            break;
                    }

                    this.rocabroteTextBox.setText(this.rocabroteText);
                    this.enableDragAndDrop();

                });
            }

            startConversation() {
                this.inAction = true;
                this.exclamation.setVisible(false);
                const rocabroteTextBox = this.add.text(window.innerWidth / 2, window.innerHeight / 4, this.rocabroteText, {
                    font: '16px',
                    fontFamily: '"Press Start 2P"',
                    fill: '#000000',
                    backgroundColor: '#ffffff',
                    padding: { x: 20, y: 10 },
                    wordWrap: { width: window.innerWidth - 40 },
                    border: '2px solid #000000'
                }).setOrigin(0.5);

                this.rocabroteTextBox = rocabroteTextBox;
                this.enableDragAndDrop();
            }

            endConversation() {

                this.rocabroteTextBox.destroy();
                this.optionTexts.forEach(optionText => optionText.destroy());
                this.optionTexts = [];
                this.inAction = false;
            }


            update() {
                const speed = 300;

                if ((this.cursors.left.isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A).isDown) && !this.inAction) {
                    this.main_character.setVelocityX(-speed);
                    this.main_character.flipX = true;

                    if (!this.isMoving) {
                        this.isMoving = true;
                        switch (this.weapon) {
                            case 'sword':
                                this.main_character.play('running_anim');
                                break;
                            case 'spear':
                                this.main_character.play('spear_running_anim');
                                break;
                            case 'bow':
                                this.main_character.play('bow_running_anim');
                                break;
                            case 'shield':
                                this.main_character.play('shield_running_anim');
                                break;
                        }
                    }

                } else if ((this.cursors.right.isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D).isDown) && !this.inAction) {

                    this.main_character.setVelocityX(speed);
                    this.main_character.flipX = false;

                    if (!this.isMoving) {
                        this.isMoving = true;
                        switch (this.weapon) {
                            case 'sword':
                                this.main_character.play('running_anim');
                                break;
                            case 'spear':
                                this.main_character.play('spear_running_anim');
                                break;
                            case 'bow':
                                this.main_character.play('bow_running_anim');
                                break;
                            case 'shield':
                                this.main_character.play('shield_running_anim');
                                break;
                        }
                    }

                } else {
                    this.main_character.setVelocityX(0);
                    this.isMoving = false;
                    switch (this.weapon) {
                        case 'sword':
                            if (this.main_character.anims.currentAnim.key !== 'idle_anim') {
                                console.log('sword');
                                this.main_character.play('idle_anim');
                            }
                            break;
                        case 'spear':
                            if (this.main_character.anims.currentAnim.key !== 'spear_anim') {
                                console.log('spear');
                                this.main_character.play('spear_anim');
                            }
                            break;
                        case 'bow':
                            if (this.main_character.anims.currentAnim.key !== 'bow_anim') {
                                console.log('bow');
                                this.main_character.play('bow_anim');
                            }
                            break;
                        case 'shield':
                            if (this.main_character.anims.currentAnim.key !== 'shield_anim') {
                                console.log('shield');
                                this.main_character.play('shield_anim');
                            }
                            break;

                        case 'mini_spear':
                            if (this.main_character.anims.currentAnim.key !== 'idle_mini_spear_anim') {
                                console.log('mini spear');
                                this.main_character.play('idle_mini_spear_anim');
                            }
                            break;

                        case 'mini_sword':
                            if (this.main_character.anims.currentAnim.key !== 'idle_mini_sword_anim') {
                                console.log('mini sword');
                                this.main_character.play('idle_mini_sword_anim');
                            }
                            break;

                        case 'mini_shield':
                            if (this.main_character.anims.currentAnim.key !== 'idle_mini_shield_anim') {
                                console.log('mini shield');
                                this.main_character.play('idle_mini_shield_anim');
                            }
                            break;
                    }

                }
                if ((this.cursors.up.isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE).isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown) && this.main_character.body.touching.down && !this.inAction) {
                    this.main_character.setVelocityY(-speed);
                }
                if (Phaser.Input.Keyboard.JustDown(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER)) && this.action && !this.inAction) {
                    this.startConversation();
                    this.exclamation.setVisible(false);
                }



                if (Phaser.Input.Keyboard.JustDown(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC))) {
                    if (this.inAction) {
                        this.inAction = false;
                        this.rocabroteTextBox.destroy();
                        this.optionTexts.forEach(optionText => optionText.destroy());
                    } else {
                        this.scene.launch('PauseScene');
                        this.scene.pause(this.scene.key);
                    }
                }


                this.hideExclamation();

                if (Phaser.Input.Keyboard.JustDown(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.H))) {
                    this.loseLife(1);
                }
            }
        }

        class PauseScene extends Phaser.Scene {
            constructor() {
                super({ key: 'PauseScene' });
            }

            create() {
                this.add.text(
                    window.innerWidth / 2,
                    window.innerHeight / 2,
                    'Pausa',
                    { font: '64px Arial', fill: '#ffffff' }
                ).setOrigin(0.5);
            }

            update() {
                if (Phaser.Input.Keyboard.JustDown(this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC))) {
                    this.scene.resume('Arvandor');
                    this.scene.stop();
                }
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            scene: [Arvandor, PauseScene],
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 750 }
                }
            },
            scale: {
                mode: Phaser.Scale.RESIZE,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            render: {
                pixelArt: true
            }
        };

        const game = new Phaser.Game(config);

    </script>
</body>

</html>