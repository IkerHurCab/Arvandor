<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
</style>
<body>

    <script>
        class Arvandor extends Phaser.Scene {
            action = false;
            constructor() {
                super('Arvandor');
            }
            preload() {
                this.load.image('exclamation', 'images/exclamation.png');
                this.load.spritesheet('idle', 'images/idle.png', { frameWidth: 32, frameHeight: 32 });
                this.load.spritesheet('rocabrote', 'images/rocabrote.png', { frameWidth: 32, frameHeight: 50 });
                this.load.image('background', 'images/background.jpg');
            }

            create() {
                this.add.image(0, 0, 'background').setOrigin(0, 0).setDisplaySize(window.innerWidth, window.innerHeight);
 
                this.anims.create({
                    key: 'rocabrote_anim',
                    frames: this.anims.generateFrameNumbers('rocabrote', { start: 0, end: -1 }),
                    frameRate: 3,
                    repeat: -1
                });
                this.anims.create({
                    key: 'idle_anim',
                    frames: this.anims.generateFrameNumbers('idle', { start: 0, end: -1 }),
                    frameRate: 4,
                    repeat: -1
                });
                const exclamation = this.add.sprite(0, 0, 'exclamation').setVisible(false);
                
                this.exclamation = exclamation;

                const main_character = this.physics.add.sprite(50, window.innerHeight, 'idle');
                const rocabrote = this.physics.add.sprite(window.innerWidth - 500, window.innerHeight, 'rocabrote');
             

                const scaleFactor = window.innerHeight * 0.15 / main_character.height;
                const scaleFactorRocabrote = window.innerHeight * 0.2 / rocabrote.height;
                
                const exclamationScaleFactor = window.innerHeight / exclamation.height;
                main_character.setScale(scaleFactor);
                rocabrote.setScale(scaleFactorRocabrote);
                exclamation.setScale(exclamationScaleFactor / 17);


                main_character.setCollideWorldBounds(true);
                rocabrote.setCollideWorldBounds(true);
                
                rocabrote.play('rocabrote_anim');
                main_character.play('idle_anim');
                this.main_character = main_character;
                this.rocabrote = rocabrote;
               
                main_character.setDepth(1);
                rocabrote.setDepth(0);

                this.cursors = this.input.keyboard.createCursorKeys();

                this.physics.add.overlap(this.main_character, this.rocabrote, this.showExclamation, null, this);
                this.physics.add.overlap(this.main_character, this.rocabrote, this.hideExclamation, null, this);
            }

            showExclamation() {
                this.exclamation.setPosition(this.rocabrote.x, this.rocabrote.y - this.rocabrote.height - 10);
                this.exclamation.setVisible(true);
                this.action = true;

            }

            hideExclamation() {
                if (Phaser.Math.Distance.Between(this.main_character.x, this.main_character.y, this.rocabrote.x, this.rocabrote.y) > 50) {
                    this.exclamation.setVisible(false);
                    this.action = false;
                }
            }

            update() {

                const speed = 400; 
                if (this.cursors.left.isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A).isDown) {
                    this.main_character.setVelocityX(-speed); 
                    this.main_character.flipX = true;
                } else if (this.cursors.right.isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D).isDown) {
                    this.main_character.setVelocityX(speed);
                    this.main_character.flipX = false;
                } else {
                    this.main_character.setVelocityX(0);
                }
                if (this.cursors.up.isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE).isDown || this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W).isDown) {
                    this.main_character.setVelocityY(-speed);
                } 

                if (this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER).isDown && this.action) {
                    this.rocabrote.destroy();
                    this.exclamation.setVisible(false);
                } 
                this.hideExclamation();
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            scene: Arvandor,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 500 }
                }
            },
            scale: {
                mode: Phaser.Scale.RESIZE,
                autoCenter: Phaser.Scale.CENTER_BOTH
            },
            render: {
                pixelArt: true
            }
        };

        const game = new Phaser.Game(config);
    </script>

</body>

</html>
